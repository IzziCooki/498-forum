<div class="container">
    <div class="card profile-card">
        <h2>Your Sheriff Badge ğŸ¤ </h2>

        <div class="user-info">
            <p><strong>Howdy, {{user.name}}!</strong></p>
            <p>Welcome back to the saloon.</p>

            {{#if user.loginTime}}
                <p><small>ğŸ• Last seen 'round these parts: {{user.loginTime}}</small></p>
            {{/if}}
            {{#if user.visitCount}}
                <p><small>ğŸ¯ Number of visits to town: {{user.visitCount}}</small></p>
            {{/if}}
        </div>

        <div>
            <h3>Your Comments ğŸ“</h3>

            <div class="comment-list">
                {{#if comments}}
                    {{#each comments}}
                        <div class="comment-card">
                            <p class="comment-text">ğŸ’¬ "{{this.text}}"</p>
                            <p class="comment-meta">
                                <small>Posted on {{this.createdAt}}</small>
                                <button onclick="deleteComment({{this.id}})" class="delete-btn">ğŸ—‘ï¸ Delete</button>
                            </p>
                        </div>
                    {{/each}}
                {{else}}
                    <div style="text-align: center; padding: 2rem; color: var(--text-muted);">
                        <p>ğŸŒµ No comments yet. Be the first to share!</p>
                    </div>
                {{/if}}
            </div>
        </div>

        <div class="actions">
            <a href="/comments" class="button button-primary">See What's New</a>
            <a href="/comment/new" class="button button-secondary">Post Your Thoughts</a>
        </div>
    </div>
</div>

<script>
async function deleteComment(id) {
    const confirmed = confirm('Are you sure you want to delete this comment?');
    if (!confirmed) return;

    try {
        const response = await fetch(`/comment/${id}`, {
            method: 'DELETE'
        });

        if (response.ok) {
            window.location.href = '/profile';
        } else {
            alert('Failed to delete comment. Please try again.');
        }
    } catch (error) {
        console.error('Error deleting comment:', error);
        alert('An error occurred. Please try again.');
    }
}
</script>